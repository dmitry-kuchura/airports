<p align="center"><img src="https://laravel.com/assets/img/components/logo-laravel.svg"></p>

Струтура проекта:

```
docker
    nginx/      Содержится конфигурационный файл nginx
    php/        Стандартный php.ini
www
    app/
        Http/
            Contollers/     AirportsController и FlightsController содержат в себе необходимые методы
            Middleware/     Файл Authentication в этом классе все запросы обрабатываются Basic авторизацией
            Requests/       Содержиться класс валидации
        Models/     Содержаться модели таблиц Аэропортов, Полетов, Превозчиков
        Repositories/       Запросы к базе данных
    config/     auth.php содержит параметры для Basic auth
    database/
        migations/      Файлы для создания таблиц в БД
        seeds/      Первоначальные данные с аэропортами перевозчиками и рейсами
    public/     Содержит минифицированые .js и .css файлы 
    resouces/
        js/     Подключение всех библиоте для javascipt
            components/ Форма поиска и результатов на Vue а так же лоадер
        sass/       Стили для приложения и отображения валидационных сообщений
        view/       Файл вывода на экран
    routes/     Содержит роутинг, для api роутов все обернуто посредником (Middlewa'ом) для Basic auth
```

### Описание работы

Как и указано по заданию данный пользователя вводятся на странице с формой

```
аэропорт вылета
аэропорт назначения
дата перелета
```

Форма выполнена компонентом `VueJS` фреймворка, она достаточно проста. Используется директива директиву `v-model` 
С ее помощью мы наполняем данными наш объект `searchQuery`. Для отправки запроса используется библиотека Axios.

С его помощью гараздо проще отправить запрос `Basic authorization`, так как сразу уменьшается объем работы по формированию токена 
из строк `username:password` которые кодируются в base64 и отправляются в `Header'е` Стандартные для приложения
`username и password` я указал в файле `www\resources\js\bootstrap.js` данные которым они должны соответсвовать указаны в файле `www\config\app.php`
их можно перезаписать в файле `www\.env`.

Например:

```
AUTH_USERNAME=admin
AUTH_PASSWORD=secret
```

Если же запрос проходит авторизацию дальше уже мы попадаем на валидацию данных пользователя

Та же реализованы базовые валидационные ошибки:

```
неверный запрос
неверно указан аэропорт
неверно указана дата вылета
ничего не найдено
```

Все правила и условия валидации написаны в файле `www\app\Http\Requests\SearchRequest.php`
Если во время выполнения кода возникнет Exception он будет обработан глобальным `www\app\Exceptions\Handler.php`
Так как проект напичканный конструкциями `try catch`, с моей точки зрения, в большинстве случаев является не совсем верным решением
Суть в том, что в подобных случаях нет никакой надобности отлавливать исключение в контроллере.
Просто можно дать ему всплыть и обработать его в ранее упомянутом `www\app\Exceptions\Handler.php`

Поиск перелетов осуществляется по заданым критериям, связываются 3 таблицы:

```
список аэропортов
список перевозчиков
перелеты
```
Аэропорты вынесены отдельно так как необходимо связывать даты необходимо по часовым поясам,
к каждому аэропорту указыываем его часовой пояс за каждым рейсом закрепляется свой перевозчик
после чего на выходе мы получаем:

```
перевозчика
номер рейса
время вылета (согласно часовому поясу аэропорта)
время прилета (согласно часовому поясу аэропорта)
длительность перелёта в минутах
```

Так же работоспособный вариант можно посмотреть по адресу http://185.65.244.203/

### Запуск работы (Если не будете использовать Docker)

Создать конфигурационный `.env` файл для фреймворка в корне `www`

Выполнить команду:

`docker-compose exec php php artisan key:generate`

И указать параметры подключения к БД в `.env` файле

```
DB_CONNECTION=pgsql
DB_HOST=db
DB_PORT=5432
DB_DATABASE=airports
DB_USERNAME=airports
DB_PASSWORD=nACZXsMczjac2STden65vYwS
```
Настроить Ваш сервер на файл `/www/public/index.php`

### Запуск работы (Если используете Docker)

Склонируйте данный репозиторий в директорию где должне распологаться проект

Далее нужно отредатировать `.env` файл в корне проекта или скопировать `cp .env.example .env`

После этого нужно запустить команду `docker-compose up -d` соберутся контейнеры для работы

Сервер будет доступен на стандартном 80м порту `localhost:80` и PostgreSQL соответсвенно `localhost:5432`.

### Настройка

По умолчанию Composer запустится самостоятельно и начнет выполнять команду install

Следующим шагом будет создать конфигурационный `.env` файл для фреймворка в корне `www`

Выполнить команду:

`docker-compose exec php php artisan key:generate`

Необходимо указать параметры подключения к БД 

```
DB_CONNECTION=pgsql
DB_HOST=db
DB_PORT=5432
DB_DATABASE=airports
DB_USERNAME=airports
DB_PASSWORD=nACZXsMczjac2STden65vYwS
```

После настройки подключения к Базе Данных нужно создать таблицы и заполнить их данными,
для создания воспользуемся миграционными файлами, а для наполнения начальных данных воспользуемся seed'ами

```
docker-compose exec php php artisan migrate
docker-compose exec php php artisan db:seed
```

После этого приложение готово к работе!
